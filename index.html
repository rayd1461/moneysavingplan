<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å­˜éŒ¢èˆ‡æ—…è²»è¦åŠƒå·¥å…· 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .day-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(60px, 1fr)); gap: 0.5rem; }
        @media (min-width: 640px) { .day-grid { grid-template-columns: repeat(10, minmax(0, 1fr)); } }
    </style>
</head>
<body class="bg-slate-50 p-4 sm:p-8">

    <div class="max-w-5xl mx-auto bg-white rounded-2xl shadow-xl p-6 sm:p-10 space-y-10">
        <header class="text-center space-y-2 border-b pb-6">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-slate-800">2026 å­˜éŒ¢èˆ‡æ›åŒ¯æ˜ç´°å·¥å…·</h1>
            <div id="summary" class="text-2xl sm:text-3xl font-bold text-green-600">
                å‰©é¤˜ç¸½é¡ï¼š0 å…ƒ
            </div>
            <div id="progress-text" class="text-slate-500 font-medium text-sm sm:text-base">
                æ¯æ—¥å­˜éŒ¢é€²åº¦è¼‰å…¥ä¸­...
            </div>
        </header>

        <section>
            <h2 class="text-2xl font-bold text-slate-800 mb-4 flex items-center">
                <span class="mr-2">ğŸ“…</span> æ¯æ—¥ 30 å…ƒå„²è“„ç´€éŒ„
            </h2>
            <div id="month-buttons" class="flex flex-wrap justify-center gap-2 mb-4"></div>
            <div id="all-months"></div>
        </section>

        <section class="bg-blue-50/50 p-6 rounded-xl">
            <h2 class="text-2xl font-bold text-blue-900 mb-4 flex items-center">
                <span class="mr-2">ğŸ’´</span> åˆ†æ‰¹æ›åŒ¯æ˜ç´°
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 items-end mb-6">
                <div>
                    <label class="block text-sm font-bold text-blue-700">æ›åŒ¯æ—¥æœŸ</label>
                    <input type="date" id="ex-date" class="mt-1 block w-full border-slate-200 rounded-lg p-2.5 shadow-sm">
                </div>
                <div>
                    <label class="block text-sm font-bold text-blue-700">æ”¯å‡ºå°å¹£ (TWD)</label>
                    <input type="number" id="ex-twd" placeholder="è¼¸å…¥å°å¹£" class="mt-1 block w-full border-slate-200 rounded-lg p-2.5 shadow-sm">
                </div>
                <div>
                    <label class="block text-sm font-bold text-blue-700">ç²å¾—æ—¥å¹£ (JPY)</label>
                    <input type="number" id="ex-jpy" placeholder="è¼¸å…¥æ—¥å¹£" class="mt-1 block w-full border-slate-200 rounded-lg p-2.5 shadow-sm">
                </div>
                <button onclick="addExchangeRecord()" class="bg-blue-600 text-white font-bold py-2.5 rounded-lg hover:bg-blue-700 transition shadow-md">æ–°å¢æ›åŒ¯</button>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full text-sm border-collapse">
                    <thead class="bg-blue-100/50 text-blue-900">
                        <tr>
                            <th class="p-3 text-left border-b">æ—¥æœŸ</th>
                            <th class="p-3 text-left border-b">æ”¯å‡ºå°å¹£ (æ”¯å‡ºé …)</th>
                            <th class="p-3 text-left border-b">ç²å¾—æ—¥å¹£ (ç¾æœ‰)</th>
                            <th class="p-3 text-center border-b">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="exchange-body" class="divide-y"></tbody>
                </table>
            </div>
            <div class="mt-4 text-right text-blue-900 font-bold">
                æ—¥å¹£æŒæœ‰ç¸½è¨ˆï¼š<span id="total-jpy-sum" class="text-xl">0</span> JPY
            </div>
        </section>

        <section class="bg-amber-50 p-6 rounded-xl">
            <h2 class="text-2xl font-bold text-amber-900 mb-4 flex items-center">
                <span class="mr-2">âœˆï¸</span> æ—…ç¨‹å–æ¬¾ç´€éŒ„ (å¾å­˜æ¬¾æ‹¿éŒ¢)
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 items-end mb-6">
                <input type="date" id="travel-date" class="border-slate-200 rounded-lg p-2.5">
                <input type="text" id="travel-name" placeholder="æ—…ç¨‹åç¨± (å¦‚ï¼šæ±äº¬å†¬å­£ä¹‹æ—…)" class="border-slate-200 rounded-lg p-2.5">
                <input type="number" id="travel-amount" placeholder="å–å‡ºå°å¹£é‡‘é¡" class="border-slate-200 rounded-lg p-2.5">
                <button onclick="addTravelRecord()" class="bg-amber-600 text-white font-bold py-2.5 rounded-lg hover:bg-amber-700 transition shadow-md">æ–°å¢æ”¯å‡ºç´€éŒ„</button>
            </div>
            <div class="overflow-x-auto border rounded-lg bg-white">
                <table class="min-w-full text-sm">
                    <thead class="bg-amber-100">
                        <tr><th class="p-3 text-left">æ—¥æœŸ</th><th class="p-3 text-left">æ—…ç¨‹åç¨±</th><th class="p-3 text-right text-red-600">å–å‡ºå°å¹£</th><th class="p-3 text-center">æ“ä½œ</th></tr>
                    </thead>
                    <tbody id="travel-body" class="divide-y"></tbody>
                </table>
            </div>
        </section>

        <section>
            <h2 class="text-2xl font-bold text-slate-800 mb-4 flex items-center">
                <span class="mr-2">ğŸ“ˆ</span> è‚¡æ¯æ˜ç´°å…¨ç´€éŒ„
            </h2>
            <div class="mb-4 flex flex-wrap gap-2">
                <button onclick="quickFillStock('0050', 1.0)" class="px-3 py-1 bg-slate-100 rounded-full text-xs hover:bg-slate-200">0050</button>
                <button onclick="quickFillStock('0056', 0.79)" class="px-3 py-1 bg-slate-100 rounded-full text-xs hover:bg-slate-200">0056</button>
                <button onclick="quickFillStock('00878', 0.55)" class="px-3 py-1 bg-slate-100 rounded-full text-xs hover:bg-slate-200">00878</button>
                <button onclick="quickFillStock('00919', 0.72)" class="px-3 py-1 bg-slate-100 rounded-full text-xs hover:bg-slate-200">00919</button>
            </div>
            <form id="dividend-form" class="bg-slate-50 p-6 rounded-xl grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                <input type="text" id="stock-id" placeholder="è‚¡å/è‚¡è™Ÿ" required class="p-2.5 border rounded-lg">
                <input type="date" id="ex-dividend-date" placeholder="é™¤æ¯æ—¥" required class="p-2.5 border rounded-lg">
                <input type="date" id="payout-date" placeholder="å…¥å¸³æ—¥" required class="p-2.5 border rounded-lg">
                <input type="number" id="shares-held" placeholder="æŒæœ‰è‚¡æ•¸" required class="p-2.5 border rounded-lg">
                <input type="number" step="0.001" id="dividend-per-share" placeholder="æ¯è‚¡è‚¡åˆ©" required class="p-2.5 border rounded-lg">
                <button type="submit" class="bg-green-600 text-white font-bold py-2.5 rounded-lg hover:bg-green-700">å„²å­˜å®Œæ•´æ˜ç´°</button>
            </form>
            <div class="overflow-x-auto border rounded-xl">
                <table class="min-w-full text-sm text-left divide-y divide-slate-200">
                    <thead class="bg-slate-50 text-slate-600">
                        <tr>
                            <th class="p-3 font-bold border-b">å…¥å¸³æ—¥</th>
                            <th class="p-3 font-bold border-b">é™¤æ¯æ—¥</th>
                            <th class="p-3 font-bold border-b">æ¨™çš„</th>
                            <th class="p-3 font-bold border-b">è‚¡æ•¸</th>
                            <th class="p-3 font-bold border-b">æ¯è‚¡è‚¡åˆ©</th>
                            <th class="p-3 font-bold border-b text-right">å¯¦é ˜ç¸½é¡</th>
                            <th class="p-3 font-bold border-b text-center">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="dividend-table-body" class="bg-white"></tbody>
                </table>
            </div>
        </section>

        <section class="border-t pt-8">
            <h2 class="text-2xl font-bold text-slate-800 mb-4">ğŸ†˜ è‡¨æ™‚æ€¥ç”¨é‡‘</h2>
            <div class="flex gap-4 mb-4">
                <button onclick="showInputModal('æé ˜', 'withdraw')" class="bg-red-500 text-white px-5 py-2 rounded-lg hover:bg-red-600 shadow-md transition">æ€¥ç”¨æé ˜</button>
                <button onclick="showInputModal('æ­¸é‚„', 'repay')" class="bg-blue-500 text-white px-5 py-2 rounded-lg hover:bg-blue-600 shadow-md transition">è³‡é‡‘æ­¸é‚„</button>
            </div>
            <div class="text-sm font-bold text-red-600 mb-4">ç›®å‰å¾…è£œé½Šæ¬ æ¬¾ï¼š<span id="outstanding-amount">0</span> å…ƒ</div>
            <div class="overflow-x-auto border rounded-xl">
                <table class="min-w-full text-sm divide-y divide-slate-200">
                    <thead class="bg-slate-50"><tr><th class="p-3 text-left">æ—¥æœŸ</th><th class="p-3 text-left">é¡åˆ¥</th><th class="p-3 text-right">é‡‘é¡</th><th class="p-3 text-center">æ“ä½œ</th></tr></thead>
                    <tbody id="emergency-fund-table-body" class="bg-white"></tbody>
                </table>
            </div>
        </section>
    </div>

    <div id="input-modal" class="fixed inset-0 bg-slate-900/60 hidden items-center justify-center p-4 z-50 backdrop-blur-sm">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md">
            <h3 id="modal-title" class="text-2xl font-bold mb-6 text-slate-800"></h3>
            <div class="space-y-4">
                <input type="number" id="input-amount" placeholder="è¼¸å…¥å°å¹£é‡‘é¡" class="w-full p-3 border rounded-xl">
                <input type="date" id="input-date" class="w-full p-3 border rounded-xl">
            </div>
            <div class="mt-8 flex justify-end gap-3">
                <button onclick="hideInputModal()" class="px-5 py-2 text-slate-500 font-medium">å–æ¶ˆ</button>
                <button id="modal-save-btn" class="bg-green-600 text-white px-6 py-2 rounded-xl font-bold">å„²å­˜æ˜ç´°</button>
            </div>
        </div>
    </div>

    <script>
        // === 1. åˆå§‹åŒ–åŸºç¤è³‡æ–™ (æ¨å±•è‡³ 2026/12/31) ===
        const startDate = new Date("2025-05-27");
        const endDate = new Date("2026-12-31");
        const savingPerDay = 30;

        const keys = {
            checked: "saving_checked_days",
            emergency: "saving_emergency_fund",
            dividend: "saving_dividend_records",
            exchange: "batch_exchange_records",
            travel: "saving_travel_expenses" // æ–°å¢æ—…è²» Key
        };

        let data = {
            checked: new Set(JSON.parse(localStorage.getItem(keys.checked)) || []),
            emergency: JSON.parse(localStorage.getItem(keys.emergency)) || [],
            dividend: JSON.parse(localStorage.getItem(keys.dividend)) || [],
            exchange: JSON.parse(localStorage.getItem(keys.exchange)) || [],
            travel: JSON.parse(localStorage.getItem(keys.travel)) || []
        };

        function init() {
            renderMonths();
            renderExchangeTable();
            renderEmergencyTable();
            renderDividendTable();
            renderTravelTable();
            updateSummary();
        }

        // === 2. ç¸½é¡æ›´æ–°é‚è¼¯ (æ ¸å¿ƒæ›´å‹•) ===
        function updateSummary() {
            // æ”¶å…¥
            const dailySaved = data.checked.size * savingPerDay;
            const divSaved = data.dividend.reduce((sum, r) => sum + (Number(r.totalDividend) || 0), 0);
            
            // æ”¯å‡º/å‚µå‹™
            const debt = data.emergency.reduce((sum, r) => sum + (r.type === 'withdraw' ? r.amount : -r.amount), 0);
            const totalExchangedTwd = data.exchange.reduce((sum, r) => sum + (Number(r.twd) || 0), 0);
            const totalTravelSpent = data.travel.reduce((sum, r) => sum + (Number(r.amount) || 0), 0);

            // ç¸½å‰©é¤˜å°å¹£ = (å­˜ + æ¯) - (æ›åŒ¯ + æ¬ æ¬¾ + æ—…ç¨‹æ‹¿å‡ºçš„éŒ¢)
            const remainingTwd = dailySaved + divSaved - debt - totalExchangedTwd - totalTravelSpent;

            const totalDays = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
            const targetTwd = totalDays * savingPerDay;
            const progress = ((dailySaved / targetTwd) * 100).toFixed(2);

            document.getElementById('summary').innerHTML = `å‰©é¤˜å¯ç”¨å°å¹£ï¼š<span class="text-green-600">${remainingTwd.toLocaleString()}</span> å…ƒ`;
            document.getElementById('progress-text').innerText = `2026 å…¨å¹´å­˜éŒ¢é”æˆç‡ï¼š${progress}% (ç›®æ¨™ï¼š${targetTwd.toLocaleString()} å…ƒ)`;
            document.getElementById('outstanding-amount').innerText = debt.toLocaleString();
            document.getElementById('total-jpy-sum').innerText = data.exchange.reduce((sum, r) => sum + r.jpy, 0).toLocaleString();
        }

        // === 3. æ›åŒ¯åŠŸèƒ½ (ç„¡åŒ¯ç‡æ¬„ä½ç‰ˆ) ===
        function addExchangeRecord() {
            const date = document.getElementById('ex-date').value;
            const twd = parseFloat(document.getElementById('ex-twd').value);
            const jpy = parseFloat(document.getElementById('ex-jpy').value);
            if (!date || !twd || !jpy) return alert("è«‹å®Œæ•´å¡«å¯«æ—¥æœŸèˆ‡é‡‘é¡");
            
            data.exchange.push({ id: Date.now(), date, twd, jpy });
            localStorage.setItem(keys.exchange, JSON.stringify(data.exchange));
            renderExchangeTable(); updateSummary();
            document.getElementById('ex-twd').value = '';
            document.getElementById('ex-jpy').value = '';
        }
        function deleteExchangeRecord(id) {
            data.exchange = data.exchange.filter(r => r.id !== id);
            localStorage.setItem(keys.exchange, JSON.stringify(data.exchange));
            renderExchangeTable(); updateSummary();
        }
        function renderExchangeTable() {
            const body = document.getElementById('exchange-body');
            body.innerHTML = data.exchange.map(r => `
                <tr>
                    <td class="p-3 border-b">${r.date}</td>
                    <td class="p-3 border-b">${r.twd.toLocaleString()} TWD</td>
                    <td class="p-3 border-b font-bold text-blue-600">${r.jpy.toLocaleString()} JPY</td>
                    <td class="p-3 border-b text-center"><button onclick="deleteExchangeRecord(${r.id})" class="text-red-400 hover:text-red-600">åˆªé™¤</button></td>
                </tr>
            `).join('');
        }

        // === 4. æ—…è²»æ”¯å‡ºåŠŸèƒ½ (æ–°å¢) ===
        function addTravelRecord() {
            const date = document.getElementById('travel-date').value;
            const name = document.getElementById('travel-name').value;
            const amount = parseFloat(document.getElementById('travel-amount').value);
            if (!date || !name || !amount) return alert("è«‹å¡«å¯«å®Œæ•´æ—…è²»æ˜ç´°");
            
            data.travel.push({ id: Date.now(), date, name, amount });
            localStorage.setItem(keys.travel, JSON.stringify(data.travel));
            renderTravelTable(); updateSummary();
            document.getElementById('travel-name').value = '';
            document.getElementById('travel-amount').value = '';
        }
        function deleteTravelRecord(id) {
            data.travel = data.travel.filter(r => r.id !== id);
            localStorage.setItem(keys.travel, JSON.stringify(data.travel));
            renderTravelTable(); updateSummary();
        }
        function renderTravelTable() {
            const body = document.getElementById('travel-body');
            body.innerHTML = data.travel.map(r => `
                <tr><td class="p-3 border-b">${r.date}</td><td class="p-3 border-b">${r.name}</td><td class="p-3 border-b text-right text-red-600 font-bold">-${r.amount.toLocaleString()}</td><td class="p-3 border-b text-center"><button onclick="deleteTravelRecord(${r.id})" class="text-red-400">åˆªé™¤</button></td></tr>
            `).join('');
        }

        // === 5. è‚¡æ¯æ˜ç´° (å®Œæ•´æ¬„ä½ç‰ˆ) ===
        window.quickFillStock = (id, rate) => {
            document.getElementById('stock-id').value = id;
            document.getElementById('dividend-per-share').value = rate;
        };
        document.getElementById('dividend-form').onsubmit = (e) => {
            e.preventDefault();
            const record = {
                id: Date.now(),
                payoutDate: document.getElementById('payout-date').value,
                exDate: document.getElementById('ex-dividend-date').value,
                stockID: document.getElementById('stock-id').value,
                shares: document.getElementById('shares-held').value,
                dps: document.getElementById('dividend-per-share').value,
                totalDividend: Math.floor(document.getElementById('shares-held').value * document.getElementById('dividend-per-share').value)
            };
            data.dividend.push(record);
            localStorage.setItem(keys.dividend, JSON.stringify(data.dividend));
            renderDividendTable(); updateSummary(); e.target.reset();
        };
        function deleteDividendRecord(id) {
            data.dividend = data.dividend.filter(r => r.id !== id);
            localStorage.setItem(keys.dividend, JSON.stringify(data.dividend));
            renderDividendTable(); updateSummary();
        }
        function renderDividendTable() {
            const body = document.getElementById('dividend-table-body');
            body.innerHTML = data.dividend.sort((a,b)=>new Date(b.payoutDate)-new Date(a.payoutDate)).map(r => `
                <tr>
                    <td class="p-3 border-b">${r.payoutDate}</td>
                    <td class="p-3 border-b text-slate-400">${r.exDate}</td>
                    <td class="p-3 border-b font-medium">${r.stockID}</td>
                    <td class="p-3 border-b">${Number(r.shares).toLocaleString()}</td>
                    <td class="p-3 border-b">${r.dps}</td>
                    <td class="p-3 border-b text-right font-bold text-green-600">${r.totalDividend.toLocaleString()}</td>
                    <td class="p-3 border-b text-center"><button onclick="deleteDividendRecord(${r.id})" class="text-red-400 text-xs">åˆªé™¤</button></td>
                </tr>
            `).join('');
        }

        // === 6. æ€¥ç”¨é‡‘èˆ‡æœˆä»½ (ç¶­æŒåŸæœ‰é‚è¼¯ä½†èª¿æ•´æ—¥æœŸç¯„åœ) ===
        function renderMonths() {
            const container = document.getElementById('month-buttons');
            let curr = new Date(startDate.getFullYear(), startDate.getMonth(), 1);
            while (curr <= endDate) {
                const m = new Date(curr);
                const btn = document.createElement('button');
                btn.className = "px-3 py-1 bg-slate-200 text-slate-700 rounded-full text-xs hover:bg-slate-300";
                btn.innerText = `${m.getFullYear()}/${m.getMonth()+1}`;
                btn.onclick = () => toggleMonth(m);
                container.appendChild(btn);
                curr.setMonth(curr.getMonth() + 1);
            }
        }
        function toggleMonth(m) {
            const id = `month-${m.getFullYear()}-${m.getMonth()}`;
            let el = document.getElementById(id);
            if (!el) {
                el = document.createElement('div'); el.id = id;
                el.className = "mt-4 p-4 bg-white rounded-xl day-grid border shadow-inner";
                const daysInMonth = new Date(m.getFullYear(), m.getMonth() + 1, 0).getDate();
                for(let d=1; d<=daysInMonth; d++) {
                    const date = new Date(m.getFullYear(), m.getMonth(), d);
                    if (date >= startDate && date <= endDate) {
                        const dateStr = date.toISOString().split('T')[0];
                        const dayBtn = document.createElement('div');
                        dayBtn.className = `p-2 border text-center cursor-pointer rounded-lg transition ${data.checked.has(dateStr) ? 'bg-green-600 text-white font-bold' : 'bg-slate-50 text-slate-400'}`;
                        dayBtn.innerText = d;
                        dayBtn.onclick = () => {
                            if(data.checked.has(dateStr)) data.checked.delete(dateStr); else data.checked.add(dateStr);
                            localStorage.setItem(keys.checked, JSON.stringify([...data.checked]));
                            dayBtn.className = `p-2 border text-center cursor-pointer rounded-lg transition ${data.checked.has(dateStr) ? 'bg-green-600 text-white font-bold' : 'bg-slate-50 text-slate-400'}`;
                            updateSummary();
                        };
                        el.appendChild(dayBtn);
                    }
                }
                document.getElementById('all-months').innerHTML = '';
                document.getElementById('all-months').appendChild(el);
            } else { el.remove(); }
        }

        function renderEmergencyTable() {
            const body = document.getElementById('emergency-fund-table-body');
            body.innerHTML = data.emergency.map((r, index) => `<tr><td class="p-3 border-b">${r.date}</td><td class="p-3 border-b ${r.type==='withdraw'?'text-red-500':'text-blue-500'} font-bold">${r.type==='withdraw'?'æé ˜':'æ­¸é‚„'}</td><td class="p-3 border-b text-right">${r.amount.toLocaleString()}</td><td class="p-3 border-b text-center"><button onclick="deleteEmergencyRecord(${index})" class="text-red-300">åˆªé™¤</button></td></tr>`).join('');
        }
        function deleteEmergencyRecord(i) { data.emergency.splice(i, 1); localStorage.setItem(keys.emergency, JSON.stringify(data.emergency)); renderEmergencyTable(); updateSummary(); }
        let currentAction = '';
        window.showInputModal = (title, action) => { currentAction = action; document.getElementById('modal-title').innerText = title; document.getElementById('input-date').value = new Date().toISOString().split('T')[0]; document.getElementById('input-modal').classList.replace('hidden', 'flex'); };
        window.hideInputModal = () => document.getElementById('input-modal').classList.replace('flex', 'hidden');
        document.getElementById('modal-save-btn').onclick = () => {
            const amt = parseInt(document.getElementById('input-amount').value);
            if(amt > 0) { data.emergency.push({ type: currentAction, amount: amt, date: document.getElementById('input-date').value }); localStorage.setItem(keys.emergency, JSON.stringify(data.emergency)); renderEmergencyTable(); updateSummary(); hideInputModal(); document.getElementById('input-amount').value = ''; }
        };

        init();
    </script>
</body>
</html>
